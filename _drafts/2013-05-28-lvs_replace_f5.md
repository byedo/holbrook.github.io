---
layout: post
title: "用lvs替代F5（草稿）"
description: ""
category: 解决方案
tags: [HA, 负载均衡, cluster, lvs]
---

以前写过一篇[《统一web访问层方案》][1]，使用nginX 作为统一的web前端代理后面的多个应用系统，并使用keeplived实现高可用。
该方案能够适应大多数企业应用的情况。但是对于互联网应用，该方案还存在一些问题没有解决：

1. 高负载
2. 
3. 
4. 



公司现状是通过F5来解决这些问题，已经有一些应用采用了 F5--> nginx --> AppServer 的访问路径。

但是F5的价格还是有点高，而且配置、扩展的难度不小。本文探讨如何用LVS替代F5解决上述问题。

[1]:http://thinkinside.tk/weblayer_nginx_keepalived


##基础知识：互联网访问的过程

客户端--->DNS--->LVS/F5--->Nginx--->AppServer/FileServer---> (LVS-->)--->DB

1. 客户端浏览器访问一个URL（使用域名而不是IP）
2. 浏览器向DNS服务器查询该域名对应的IP地址


看似很简单，但是有一些问题会影响速度：

1. 不同的地区、不同的网络（电信、联通、移动），客户的访问速度可能不同。需要为服务器配置多条网络链路，并使得来自不同网络的客户通过不同的链路入口到达服务器。
	（方案：
	1. 多个DNS？？？转换后的IP地址很可能是 不一样的
	2. CDN？？？是什么？
	）

2. 在[前面的方案][1]中，使用两台主-从方式的nginx作为转发服务器。但是对于互联网访问，有很高的并发，需要多台web服务器同时工作。
	（方案：nginx的多活？
	  这一很复杂的过程是由几个系统配合完成，其中最关键的便是LVS(Linux Virtual Server)
	）

3. 





##新的需求
（结合以前的）


##LVS是什么
LVS(Linux Virtual Server)，世界上最流行的负载均衡系统之一，正是由目前在淘宝网供职的章文嵩博士开发的。

开源，国产

###LVS的优势（与原方案对比）

###LVS的劣势（与原方案对比）

##具体方案


###高可用
[前面的方案](http://thinkinside.tk/weblayer_nginx_keepalived/)中已经提到了[使用keepalived实现nginX的高可用](http://thinkinside.tk/weblayer_nginx_keepalived/#menuIndex5)。


##扩展问题

###浏览器并发限制

　　经过一系列复杂的逻辑运算和数据处理，用于这次给你看的淘宝网首页的HTML内容便生成成功了。对web前端稍微有点常识的童鞋都应该知道，下 一步浏览器会去加载页面中用到的css、js、图片、脚本和资源文件。但是可能相对较少的同学才会知道，你的浏览器在同一个域名下并发加载的资源数量是有 限制的，例如IE6-7是两个，IE8是6个，Chrome各版本不大一样，一般是4-6个。我刚刚看了一下，我访问淘宝网首页需要加载126个资源，那 么如此小的并发连接数自然会加载很久。所以前端开发人员往往会将上述这些资源文件分布在好多个域名下，变相的绕过浏览器的这个限制，同时也为下文的CDN 工作做准备。


###异地分发
据不可靠消息，在双十一当天高峰，淘宝的访问流量最巅峰达到871GB/S。这个数字意味着需要178万个4Mb带宽 的家庭宽带才能负担的起，也完全有能力拖垮一个中小城市的全部互联网带宽。那么显然，这些访问流量不可能集中在一起。并且大家都知道，不同地区不同网络 （电信、联通等）之间互访会非常缓慢，但是你却发现很少发现淘宝网访问缓慢。这便是CDN(Content Delivery Network)，即内容分发网络的作用。淘宝在全国各地建立了数十上百个CDN节点，利用一些手段保证你访问的（这里主要指js、css、图片等）地方是离你最近的CDN节点，这样便保证了大流量分散在各地访问的加速节点上。
　　这便出现了一个问题，那就是假若一个卖家发布了一个新的宝贝，上传了几张新的宝贝图片，那么淘宝网如何保证全国各地的CDN节点中都会同步的存在这几张图 片供用户使用呢？这里边就涉及到了大量的内容分发与同步的相关技术。淘宝开发了分布式文件系统TFS(Taobao File System)来处理这类问题。



##实施计划


